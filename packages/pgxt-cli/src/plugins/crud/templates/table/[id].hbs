import { routeMiddlewareMapper } from "@appril/api/lib";

import { paramsSchema, useGlobalSpecs } from "../[id]";

import {
  type UpdateT,
  type RetrieveResponse,
  type UpdateResponse,
  type DeleteResponse,
  useWrapper,
  retrieveWrapper,
  updateWrapper,
  deleteWrapper,
} from ".";

export { head, options, post, put } from "@appril/api";

export * from "./typeLiterals";

type DefaultParamsT = { id: number | string }

export const use = useWrapper<DefaultParamsT>()

export const get = retrieveWrapper<
  DefaultParamsT,
  () => Promise<RetrieveResponse>
>()

export const patch = updateWrapper<
  DefaultParamsT,
  (payload: UpdateT) => Promise<UpdateResponse>
>()

export const del = deleteWrapper<
  DefaultParamsT,
  () => Promise<DeleteResponse>
>()

type Factory<
  ParamsT
> = (a: {
  use: ReturnType<typeof useWrapper<ParamsT>>;
  get: ReturnType<typeof retrieveWrapper<ParamsT, () => Promise<RetrieveResponse>>>;
  patch: ReturnType<typeof updateWrapper<ParamsT, (p: UpdateT) => Promise<UpdateResponse>>>;
  del: ReturnType<typeof deleteWrapper<ParamsT, () => Promise<DeleteResponse>>>;
}) => Array<any>

export default <
  ParamsT extends DefaultParamsT = DefaultParamsT
>(
  factory: Factory<ParamsT>
) => routeMiddlewareMapper("{{route.file}}", {
  paramsSchema,
  factorySpecs: factory({ use, get, patch, del }),
  useGlobalSpecs: useGlobalSpecs(),
});
